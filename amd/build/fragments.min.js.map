{"version":3,"sources":["../src/fragments.js"],"names":["define","$","cfg","log","reportfragment","init","each","promise","done","fragmentloader","debug","elm","that","url","wwwroot","attr","get","data","newval","source","html","field","parseInt","formula","regexp","vars","match","variable","varvalue","replace","ratioresult","eval"],"mappings":"AAsBAA,OAAM,4BAAC,CAAC,QAAD,CAAW,aAAX,CAA0B,UAA1B,CAAD,CAAwC,SAAUC,CAAV,CAAaC,GAAb,CAAkBC,GAAlB,CAAuB,CAEjE,GAAIC,CAAAA,cAAc,CAAG,CACjBC,IAAI,CAAE,eAAW,CAGbJ,CAAC,CAAC,oBAAD,CAAD,CAAwBK,IAAxB,CAA6B,UAAW,CACpCL,CAAC,CAAC,IAAD,CAAD,CAAQM,OAAR,GAAkBC,IAAlB,CAAuBJ,cAAc,CAACK,cAAf,CAA8B,IAA9B,CAAvB,CACH,CAFD,EAIAN,GAAG,CAACO,KAAJ,CAAU,gDAAV,CACH,CATgB,CAejBD,cAAc,CAAE,wBAASE,GAAT,CAAc,IACtBC,CAAAA,IAAI,CAAGX,CAAC,CAACU,GAAD,CADc,CAGtBE,GAAG,CAAGX,GAAG,CAACY,OAAJ,CAAc,kCAHE,CAI1BD,GAAG,EAAI,mBAAP,CACAA,GAAG,EAAI,aAAeD,IAAI,CAACG,IAAL,CAAU,oBAAV,CAAtB,CACAF,GAAG,EAAI,YAAcD,IAAI,CAACG,IAAL,CAAU,mBAAV,CAArB,CACAF,GAAG,EAAI,WAAaD,IAAI,CAACG,IAAL,CAAU,kBAAV,CAApB,CAEAd,CAAC,CAACe,GAAF,CAAMH,GAAN,CAAW,SAASI,IAAT,CAAe,CACtB,GAAIC,CAAAA,MAAJ,CACAf,GAAG,CAACO,KAAJ,CAAU,kCAAsCO,IAAI,CAACE,MAA3C,CAAoD,KAA9D,EACAlB,CAAC,CAAC,0BAA2BgB,IAAI,CAACE,MAAhC,CAAyC,KAA1C,CAAD,CAAiDC,IAAjD,CAAsDH,IAAI,CAACG,IAA3D,EAGA,IAAK,GAAIC,CAAAA,KAAT,GAAkBJ,CAAAA,IAAI,CAACA,IAAvB,CAA6B,CACzBC,MAAM,CAAGI,QAAQ,CAACrB,CAAC,CAAC,YAAcoB,KAAf,CAAD,CAAuBD,IAAvB,EAAD,CAAjB,CACAjB,GAAG,CAACO,KAAJ,CAAU,8BAA+BW,KAAzC,EACAlB,GAAG,CAACO,KAAJ,CAAU,oBAAqBQ,MAA/B,EACAjB,CAAC,CAAC,YAAcoB,KAAf,CAAD,CAAuBD,IAAvB,CAA4BF,MAAM,CAAGI,QAAQ,CAACL,IAAI,CAACA,IAAL,CAAUI,KAAV,CAAD,CAA7C,CACH,CAIDpB,CAAC,CAAC,gBAAD,CAAD,CAAoBK,IAApB,CAAyB,UAAW,IAC5BM,CAAAA,IAAI,CAAGX,CAAC,CAAC,IAAD,CADoB,CAE5BsB,OAAO,CAAGX,IAAI,CAACG,IAAL,CAAU,cAAV,CAFkB,CAG5BS,MAAM,CAAG,mBAHmB,CAI5BC,IAAI,CAAGF,OAAO,CAACG,KAAR,CAAcF,MAAd,CAJqB,CAKhC,IAAK,GAAIG,CAAAA,QAAT,GAAqBF,CAAAA,IAArB,CAA2B,CACvBG,QAAQ,CAAGN,QAAQ,CAACrB,CAAC,CAAC,IAAM0B,QAAP,CAAD,CAAkBP,IAAlB,EAAD,CAAnB,CACAjB,GAAG,CAACO,KAAJ,CAAU,aAAeiB,QAAf,CAA0B,QAA1B,CAAqCC,QAA/C,EACAL,OAAO,CAACM,OAAR,CAAgBF,QAAhB,CAA0BC,QAA1B,CACH,CACDzB,GAAG,CAACO,KAAJ,CAAU,WAAaa,OAAvB,EACA,GAAIO,CAAAA,WAAW,CAAGC,IAAI,CAACR,OAAD,CAAtB,CACA,KAAKH,IAAL,CAAU,IAAMU,WAAN,CAAoB,KAA9B,CACH,CAbD,CAcH,CA7BD,CA6BG,MA7BH,CA8BH,CAtDgB,CAArB,CAyDA,MAAO1B,CAAAA,cACV,CA5DK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n * @module     report_vmoodle\n * @package    report\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// jshint unused: true, undef:true\ndefine(['jquery', 'core/config', 'core/log'], function ($, cfg, log) {\n\n    var reportfragment = {\n        init: function() {\n\n            // Attach to each expected fragment slot an asynchronous loading.\n            $('.delegated-content').each(function() {\n                $(this).promise().done(reportfragment.fragmentloader(this));\n            });\n\n            log.debug('ADM Vmoodle Report Report fragment initialized');\n        },\n\n        /*\n         * This function launches asyncronous progressive loading. One instance\n         * of this function gets the content of one content slot.\n         */\n        fragmentloader: function(elm) {\n            var that = $(elm);\n\n            var url = cfg.wwwroot + '/report/vmoodle/ajax/service.php';\n            url += '?what=getfragment';\n            url += '&fragment=' + that.attr('delegated-fragment');\n            url += '&wwwroot=' + that.attr('delegated-context');\n            url += '&filter=' + that.attr('delegated-filter');\n\n            $.get(url, function(data) {\n                var newval;\n                log.debug('Feeding '+'tr[delegated-context=\"' + data.source + '\"]');\n                $('tr[delegated-context=\"' + data.source + '\"]').html(data.html);\n\n                // find sumators and add results in it.\n                for (var field in data.data) {\n                    newval = parseInt($('#sumator-' + field).html());\n                    log.debug('ADM Vmoodle updating field '+ field);\n                    log.debug('ADM origin value '+ newval);\n                    $('#sumator-' + field).html(newval + parseInt(data.data[field]));\n                }\n\n                // sumator-ratios provide formula to refresh their values.\n                // formulas contain non terminal references to sumators ids.\n                $('.sumator-ratio').each(function() {\n                    var that = $(this);\n                    var formula = that.attr('data-formula');\n                    var regexp = '/(sumator-[/w]+)/';\n                    var vars = formula.match(regexp);\n                    for (var variable in vars) {\n                        varvalue = parseInt($('#' + variable).html());\n                        log.debug('replacing ' + variable + ' with ' + varvalue);\n                        formula.replace(variable, varvalue);\n                    }\n                    log.debug('formula ' + formula);\n                    var ratioresult = eval(formula);\n                    this.html('(' + ratioresult + '% )');\n                })\n            }, 'json');\n        }\n    };\n\n    return reportfragment;\n});"],"file":"fragments.min.js"}