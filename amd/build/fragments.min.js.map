{"version":3,"sources":["../src/fragments.js"],"names":["define","$","cfg","log","reportfragment","init","each","fragmentloader","debug","elm","that","url","wwwroot","attr","get","data","newval","source","html","field","parseInt","formula","regexp","vars","match","variable","varvalue","replace","ratioresult","eval","toLocaleString","minimumFractionDigits","maximumFractionDigits"],"mappings":"AAsBAA,OAAM,4BAAC,CAAC,QAAD,CAAW,aAAX,CAA0B,UAA1B,CAAD,CAAwC,SAAUC,CAAV,CAAaC,GAAb,CAAkBC,GAAlB,CAAuB,CAEjE,GAAIC,CAAAA,cAAc,CAAG,CACjBC,IAAI,CAAE,eAAW,CAGbJ,CAAC,CAAC,oBAAD,CAAD,CAAwBK,IAAxB,CAA6B,UAAW,CAEpCF,cAAc,CAACG,cAAf,CAA8B,IAA9B,CACH,CAHD,EAKAJ,GAAG,CAACK,KAAJ,CAAU,gDAAV,CACH,CAVgB,CAgBjBD,cAAc,CAAE,wBAASE,GAAT,CAAc,IACtBC,CAAAA,IAAI,CAAGT,CAAC,CAACQ,GAAD,CADc,CAGtBE,GAAG,CAAGT,GAAG,CAACU,OAAJ,CAAc,kCAHE,CAI1BD,GAAG,EAAI,mBAAP,CACAA,GAAG,EAAI,aAAeD,IAAI,CAACG,IAAL,CAAU,oBAAV,CAAtB,CACAF,GAAG,EAAI,YAAcD,IAAI,CAACG,IAAL,CAAU,mBAAV,CAArB,CACAF,GAAG,EAAI,WAAaD,IAAI,CAACG,IAAL,CAAU,kBAAV,CAApB,CAEAZ,CAAC,CAACa,GAAF,CAAMH,GAAN,CAAW,SAASI,IAAT,CAAe,CACtB,GAAIC,CAAAA,MAAJ,CACAb,GAAG,CAACK,KAAJ,CAAU,kCAAsCO,IAAI,CAACE,MAA3C,CAAoD,KAA9D,EACAhB,CAAC,CAAC,0BAA2Bc,IAAI,CAACE,MAAhC,CAAyC,KAA1C,CAAD,CAAiDC,IAAjD,CAAsDH,IAAI,CAACG,IAA3D,EAGA,IAAK,GAAIC,CAAAA,KAAT,GAAkBJ,CAAAA,IAAI,CAACA,IAAvB,CAA6B,CACzBC,MAAM,CAAGI,QAAQ,CAACnB,CAAC,CAAC,YAAckB,KAAf,CAAD,CAAuBD,IAAvB,EAAD,CAAjB,CACAf,GAAG,CAACK,KAAJ,CAAU,8BAA+BW,KAAzC,EACAhB,GAAG,CAACK,KAAJ,CAAU,oBAAqBQ,MAA/B,EACAf,CAAC,CAAC,YAAckB,KAAf,CAAD,CAAuBD,IAAvB,CAA4BF,MAAM,CAAGI,QAAQ,CAACL,IAAI,CAACA,IAAL,CAAUI,KAAV,CAAD,CAA7C,CACH,CAIDlB,CAAC,CAAC,gBAAD,CAAD,CAAoBK,IAApB,CAAyB,UAAW,IAC5BI,CAAAA,IAAI,CAAGT,CAAC,CAAC,IAAD,CADoB,CAE5BoB,OAAO,CAAGX,IAAI,CAACG,IAAL,CAAU,cAAV,CAFkB,CAG5BS,MAAM,oBAHsB,CAI5BC,IAAI,CAAGF,OAAO,CAACG,KAAR,CAAcF,MAAd,CAJqB,6EAKhC,kBAAuBC,IAAvB,0BAAWE,QAAX,yFAA6B,CAAlBA,QAAkB,aACzBC,QAAQ,CAAGN,QAAQ,CAACnB,CAAC,CAAC,IAAMwB,QAAP,CAAD,CAAkBP,IAAlB,EAAD,CAAnB,CACAf,GAAG,CAACK,KAAJ,CAAU,aAAeiB,QAAf,CAA0B,QAA1B,CAAqCC,QAA/C,EACAL,OAAO,CAAGA,OAAO,CAACM,OAAR,CAAgBF,QAAhB,CAA0BC,QAA1B,CACb,CAT+B,4LAUhCvB,GAAG,CAACK,KAAJ,CAAU,WAAaa,OAAvB,EACA,GAAIO,CAAAA,WAAW,CAAGC,IAAI,CAACR,OAAD,CAAtB,CACAX,IAAI,CAACQ,IAAL,CAAUU,WAAW,CAACE,cAAZ,QAAsC,CAClEC,qBAAqB,CAAE,CAD2C,CAElEC,qBAAqB,CAAE,CAF2C,CAAtC,EAGzB,GAHe,CAIH,CAhBD,CAiBH,CAhCD,CAgCG,MAhCH,CAiCH,CA1DgB,CAArB,CA6DA,MAAO5B,CAAAA,cACV,CAhEK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n * @module     report_vmoodle\n * @package    report\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// jshint unused: true, undef:true\ndefine(['jquery', 'core/config', 'core/log'], function ($, cfg, log) {\n\n    var reportfragment = {\n        init: function() {\n\n            // Attach to each expected fragment slot an asynchronous loading.\n            $('.delegated-content').each(function() {\n                // $(this).promise().done(reportfragment.fragmentloader(this));\n                reportfragment.fragmentloader(this);\n            });\n\n            log.debug('ADM Vmoodle Report Report fragment initialized');\n        },\n\n        /*\n         * This function launches asyncronous progressive loading. One instance\n         * of this function gets the content of one content slot.\n         */\n        fragmentloader: function(elm) {\n            var that = $(elm);\n\n            var url = cfg.wwwroot + '/report/vmoodle/ajax/service.php';\n            url += '?what=getfragment';\n            url += '&fragment=' + that.attr('delegated-fragment');\n            url += '&wwwroot=' + that.attr('delegated-context');\n            url += '&filter=' + that.attr('delegated-filter');\n\n            $.get(url, function(data) {\n                var newval;\n                log.debug('Feeding '+'tr[delegated-context=\"' + data.source + '\"]');\n                $('tr[delegated-context=\"' + data.source + '\"]').html(data.html);\n\n                // find sumators and add results in it.\n                for (var field in data.data) {\n                    newval = parseInt($('#sumator-' + field).html());\n                    log.debug('ADM Vmoodle updating field '+ field);\n                    log.debug('ADM origin value '+ newval);\n                    $('#sumator-' + field).html(newval + parseInt(data.data[field]));\n                }\n\n                // sumator-ratios provide formula to refresh their values.\n                // formulas contain non terminal references to sumators ids.\n                $('.sumator-ratio').each(function() {\n                    var that = $(this);\n                    var formula = that.attr('data-formula');\n                    var regexp = new RegExp('(sumator-[a-z]+)', 'g');\n                    var vars = formula.match(regexp);\n                    for (const variable of vars) {\n                        varvalue = parseInt($('#' + variable).html());\n                        log.debug('replacing ' + variable + ' with ' + varvalue);\n                        formula = formula.replace(variable, varvalue);\n                    }\n                    log.debug('formula ' + formula);\n                    var ratioresult = eval(formula);\n                    that.html(ratioresult.toLocaleString(undefined, { \n  minimumFractionDigits: 2, \n  maximumFractionDigits: 2 \n}) + '%');\n                })\n            }, 'json');\n        }\n    };\n\n    return reportfragment;\n});"],"file":"fragments.min.js"}